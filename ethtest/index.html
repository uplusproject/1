<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>连接钱包</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.5.0.umd.min.js"></script>
</head>
<body>
    <h1>连接钱包</h1>
    <button id="connectButton">连接钱包</button>
    <div id="accountInfo" style="margin-top: 20px;"></div>

    <script>
        document.getElementById('connectButton').onclick = async () => {
            const connectButton = document.getElementById('connectButton');
            connectButton.disabled = true; // 禁用按钮，防止重复点击

            try {
                if (typeof window.ethereum === 'undefined') {
                    throw new Error('MetaMask 未安装');
                }

                console.log('请求 MetaMask 账户授权...');
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });

                // 检查是否有账户返回
                if (!accounts || accounts.length === 0) {
                    throw new Error('无法连接到账户，请检查 MetaMask 设置');
                }

                const account = accounts[0]; // 获取第一个账户
                console.log('当前连接账户:', account);
                document.getElementById('accountInfo').innerText = `已连接账户: ${account}`;

            } catch (error) {
                console.error('连接钱包失败:', error);
                document.getElementById('accountInfo').innerText = `连接钱包失败: ${error.message}`;
            } finally {
                connectButton.disabled = false; // 恢复按钮
            }
        };
    </script>
</body>
</html>
