<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>连接钱包</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.5.0.umd.min.js"></script>
</head>
<body>
    <h1>连接钱包</h1>
    <button id="connectButton">连接钱包</button>
    <div id="accountInfo" style="margin-top: 20px;"></div>

    <script>
        document.getElementById('connectButton').onclick = async () => {
            const connectButton = document.getElementById('connectButton');
            connectButton.disabled = true; // 禁用按钮，防止重复点击

            try {
                // 检查 MetaMask 是否安装
                if (typeof window.ethereum === 'undefined') {
                    throw new Error('MetaMask 未安装，请安装后再试。');
                }

                console.log('正在连接钱包...');
                // 直接获取当前账户
                const accounts = await window.ethereum.request({ method: 'eth_accounts' });

                // 检查返回的账户
                console.log('获取到的账户:', accounts); // 输出账户列表到控制台

                if (!accounts || accounts.length === 0) {
                    throw new Error('没有返回账户，请检查 MetaMask 设置。');
                }

                const account = accounts[0]; // 获取第一个账户
                console.log('当前连接账户:', account);
                document.getElementById('accountInfo').innerText = `已连接账户: ${account}`;

            } catch (error) {
                // 捕获连接失败的错误并显示
                console.error('连接钱包失败:', error);
                document.getElementById('accountInfo').innerText = `连接钱包失败: ${error.message}`;
            } finally {
                connectButton.disabled = false; // 恢复按钮
            }
        };
    </script>
</body>
</html>
